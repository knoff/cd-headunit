# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ HeadUnit OS (Native Edition)

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º—É—é –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ –±–∞–∑–µ Linux (Debian/Raspberry Pi OS), –∏—Å–ø–æ–ª—å–∑—É—é—â—É—é **"–ù–∞—Ç–∏–≤–Ω—É—é"** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

–ú—ã –æ—Ç–∫–∞–∑–∞–ª–∏—Å—å –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ (Docker) –≤ –ø–æ–ª—å–∑—É –ø—Ä—è–º–æ–π —Ä–∞–±–æ—Ç—ã —Å `systemd` –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É—Ç—è–º–∏ (Runtime Linking), —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

1. –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (RAM/CPU).
2. –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º.
3. "–°–ª–æ–µ–Ω—É—é" —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

## üèó –ß–µ—Ç—ã—Ä–µ —É—Ä–æ–≤–Ω—è —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ 4 –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Å–ª–æ—è —Å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

### 1. Image Layer (–û–±—Ä–∞–∑)

- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –§–∏–∑–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª `.img`, –ø—Ä–æ—à–∏–≤–∞–µ–º—ã–π –Ω–∞ SD-–∫–∞—Ä—Ç—É.
- **–í–µ—Ä—Å–∏—è:** `image_version` (git tag + hash, –Ω–∞–ø—Ä–∏–º–µ—Ä `v0.5.0-12-g3a1b2c`).
- **–°–æ—Å—Ç–∞–≤:** –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–¥–µ–ª–æ–≤, –∑–∞–≥—Ä—É–∑—á–∏–∫, —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–ø—Ä–æ—à–∏–≤–∫–∞.

### 2. OS Layer (–°–∏—Å—Ç–µ–º–∞)

- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –ë–∞–∑–æ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞. –Ø–¥—Ä–æ, –¥—Ä–∞–π–≤–µ—Ä—ã, —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã (`apt`), Python-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä.
- **–í–µ—Ä—Å–∏—è:** `os_version` (X.Y.Z, –Ω–∞–ø—Ä–∏–º–µ—Ä `0.5.0`).
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç.
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/usr`, `/lib`, `/bin` (Read-Only).

### 3. Services Layer (–°–µ—Ä–≤–∏—Å—ã –∏ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏)

- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** Shared libraries (`cd-protocol`), –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (MQTT, DB), –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã.
- **–í–µ—Ä—Å–∏—è:** `services_version` (X.Y.Z, –∏–∑ `services/manifest.json`).
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –¢—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é OS (`os >= 0.4.0`).
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/opt/headunit/factory/services` –∏–ª–∏ `/data/components/services/`.

### 4. App Layer (–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (Backend, Gateway, UI).
- **–í–µ—Ä—Å–∏—è:** `app_version` (X.Y.Z, –∏–∑ `src/manifest.json`).
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –¢—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é Services (`services >= 0.5.0`).
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/opt/headunit/factory/app` –∏–ª–∏ `/data/components/app/`.

---

## üîó Runtime Linking (Boot Linker)

–ö–ª—é—á–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã ‚Äî **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ**.

–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å `headunit-boot-linker` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ —Ä–∞–Ω–Ω–µ–º —ç—Ç–∞–ø–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–µ—Ä—Å–∏—é OS.
2. –°–∫–∞–Ω–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ Services –∏ App –≤ "–ó–∞–≤–æ–¥—Å–∫–æ–º" —Ä–∞–∑–¥–µ–ª–µ (`/opt`) –∏ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º" (`/data`).
3. –í—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ –≤–µ—Ä—Å–∏–∏, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º.
4. –°–æ–∑–¥–∞–µ—Ç —Å–∏–º–ª–∏–Ω–∫–∏ –≤ `/run/headunit/`:
   - `active_services` -> –ø—É—Ç—å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏.
   - `active_app` -> –ø—É—Ç—å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏.

–í—Å–µ Systemd-—Å–µ—Ä–≤–∏—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π —á–µ—Ä–µ–∑ `/run/headunit/active_...`.

## üíæ –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```text
/
‚îú‚îÄ‚îÄ opt/headunit/factory/       # [RO] –ó–∞–≤–æ–¥—Å–∫–∏–µ –≤–µ—Ä—Å–∏–∏ (Fallback)
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ
‚îú‚îÄ‚îÄ data/components/            # [RW] –°–∫–∞—á–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (OTA)
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ v1.2.0/
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îî‚îÄ‚îÄ v1.1.0/
‚îÇ
‚îú‚îÄ‚îÄ run/headunit/               # [RAM] –ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ active_app -> /data/components/app/v1.2.0
‚îÇ   ‚îî‚îÄ‚îÄ active_services -> /opt/headunit/factory/services
‚îÇ
‚îî‚îÄ‚îÄ etc/headunit-release        # –°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏—è—Ö –æ–±—Ä–∞–∑–∞

```
