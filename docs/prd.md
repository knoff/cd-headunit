# PRD: HeadUnit OS (CoffeeDigital Reborn)

## 1. Обзор продукта

**HeadUnit OS** — это специализированная операционная система и программная платформа для профессиональной кофемашины-лаборатории CoffeeDigital. Система служит "мозгом" устройства, обеспечивая прецизионный контроль процесса экстракции, сбор данных и взаимодействие с пользователем через высокотехнологичный интерфейс.

## 2. Целевая аудитория

- **Профессионалы:** Бариста, обжарщики, Q-грейдеры.
- **Специалисты:** Сервисные инженеры (обслуживание и ремонт).
- **Ученики:** Начинающие бариста (система должна помогать корректировать ошибки и обучать).
  > [!NOTE]
  > Оборудование не предназначено для конечных покупателей (self-service), так как позиционируется как инструмент профессионального класса.

## 3. Цели и задачи

- **Тотальный контроль:** Обеспечение максимально точного управления параметрами экстракции.
- **Data Science в кофе:** Сбор детальных данных о каждой экстракции для дальнейшего анализа, в том числе с использованием ИИ.
- **Повторяемость:** Гарантия идентичного результата как в рамках одной кофейни, так и в глобальном масштабе (всей сети или клиентов обжарщика).
- **Обучение:** Снижение порога входа и затрат на подготовку персонала за счет интерактивных подсказок и контроля ошибок.

## 4. Ключевые сценарии использования

1. **Приготовление кофе (основной сценарий, 90% времени):** Быстрый доступ к запуску экстракции по выбранному профилю.
2. **Профилирование:** Создание, настройка и тонкая корректировка профилей экстракции (давление, температура, поток (входной и выходной), энергия экстракции).
3. **Аналитика и калибровка вкуса:** Сбор статистики экстракций и сопоставление их с субъективной оценкой (SCA Cupping).
4. **Обучение:** Интерактивное руководство по приготовлению, обратная связь от системы на основе данных.
5. **Сервис:** Диагностика узлов, калибровка датчиков и обновление ПО.

## 5. Экосистема и SaaS-интеграция

HeadUnit OS является частью глобальной экосистемы Reborn. Несмотря на то, что облачная часть описывается в отдельном PRD (SaaS), HeadUnit OS должна поддерживать:

- **Синхронизацию:** Обмен профилями экстракции, рецептами и комментариями шеф-бариста.
- **Мониторинг:** Передача телеметрии и данных о состоянии оборудования в реальном времени.
- **Удаленное управление:** Возможность дистанционного обновления ПО (OTA) и изменения конфигураций.
- **Глобальную повторяемость:** Доступ к единой базе "эталонных" профилей для всей сети кофеен или клиентов обжарщика.

## 6. Сбор данных и аналитика

Система фиксирует два типа данных:

### А. Технические параметры (5 ключевых показателей)

Каждая экстракция записывается как фактический график изменения:

1. **Давление** (Pressure).
2. **Температура** (Temperature).
3. **Входной поток** (Flow In).
4. **Выходной поток** (Flow Out).
5. **Энергия экстракции** (Extraction Energy).

### Б. Органолептические параметры (SCA Cupping)

Для оценки результата и обучения система позволяет вводить данные по стандартам SCA:

- Аромат (Fragrance/Aroma), Вкус (Flavor), Послевкусие (Aftertaste).
- Кислотность (Acidity), Тело (Body), Баланс (Balance).
- Чистота чашки (Clean Cup), Сладость (Sweetness), Однородность (Uniformity).
- Общая оценка и дефекты.

## 7. Режим обучения и "Кофейная Лаборатория"

Интеллектуальная составляющая системы направлена на развитие навыков пользователя:

- **Итеративный процесс:** Цикл "Экстракция -> Оценка (SCA) -> Изменение параметров -> Новая итерация".
- **Анализ влияния:** Наглядное сравнение того, как изменение технического параметра (например, температуры или потока) повлияло на конкретный вкусовой показатель.
- **Справочная база:** Вывод рецептов, пошаговых инструкций, комментариев инструкторов и шеф-бариста напрямую на экран устройства.
- **Коррекция ошибок:** Визуальные и тактильные (через ручки с обратной связью) подсказки при отклонении от заданного процесса.

## 8. Требования к интерфейсу и аппаратному обеспечению

- **Основной дисплей:** Ultrawide сенсорный экран с разрешением **2880 x 824**.
- **Периферия (ESP32 + ESP-NOW):**
  - Ручки управления паром с обратной связью (haptic feedback).
  - Ручки управления кофейными группами с обратной связью.
  - Дополнительные вспомогательные экраны (на ручках, экраны пара).
  - Физические кнопки управления группами.
- **Сетевое взаимодействие:** Общий протокол обмена данными между HeadUnit (Raspberry Pi) и модулями на базе ESP32.

## 9. Техническая архитектура (HeadUnit OS)

- **База:** Native Linux (Debian/Raspberry Pi OS) без контейнеризации.
- **Файловая система:** Read-only корень с OverlayFS в RAM для надежности.
- **Слоистость:** Разделение на OS Layer, Services Layer (инфраструктура) и App Layer (бизнес-логика).
- **OTA:** Механизм обновлений "по воздуху" с возможностью отката и проверки целостности.

## 10. Метрики успеха (MVP)

- Успешное выполнение экстракции тестовой чашки в полном соответствии с заданным сложным профилем.
- Стабильный сбор данных по 5 техническим параметрам и возможность ввода SCA-анкеты.
- Синхронизация данных об экстракции с локальной БД или SaaS-заглушкой.
